% Higher Entity Relationship Modell TeX Style
\def\HPDate $#1 #2 #3${#2}
\def\HPAuthor $#1 #2${#2}
\def\HPRev $#1 #2 ${#2}

\def\HERMpicId{\HPDate $Date: 2003-02-10 17:36:37 $ higher entity relationship diagramms }

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{herm-pic}[\HERMpicId]

\RequirePackage{texdraw}

\input txdtools

\typeout{HERM-Pic <v0.4.1>(\HPRev $Revision: 1.13 $) \HERMpicId by \HPAuthor $Author: sven $ }

% This package provide some graphical elements to draw 
% HER Modells.

% \hermunit removed because whith the texdraw package there is no usage of it

% hermunit sets the percent thet the unit will be to 1cm 
%    -> if onr unit is 0.5cm the hermunit must be 50
\newcount\hpunit
\hpunit=50

\def\sethermunit#1{\hpunit=#1}

\def\hermunit{\hpunit}
% ---  schema environment  ---

% \begin{schema}(x,y)
\def\schema{%
  \realdiv{\hermunit}{100} \hus
  \begin{texdraw}
    
    \drawdim{cm} \setunitscale \hus
}%

% \end{schema}
\def\endschema{
  \end{texdraw}
}
% ---  Entity  ---

% \entity(x,y){name}

% Hoehe: 2 LE Breite: 4 LE
\def\entity(#1,#2)#3{%
  \move(#1 #2)
  \bsegment
  \rlvec(4 0)%
  \rlvec(0 2)%
  \rlvec(-4 0)%
  \rlvec(0 -2)%
  \textref h:C v:C \htext(2 1){#3}
  \esegment
}%

% ---  Relation  ---

% \relation(x,y){name}

% Hoehe 2LE Breite 4LE
\def\relation(#1,#2)#3{%
  \move(#1 #2)
  \bsegment
  \move(0 1)
  \lvec(2 2)
  \lvec(4 1)
  \lvec(2 0)
  \lvec(0 1)
  \textref h:C v:C \htext(2 1){#3}
  \esegment
}%

% ---  Cluster  ---

% \cluster(x,y)

% defines the cluster representation
% width = 2
% height = 2
%
% a circle width a plus in it
\def\cluster(#1,#2){%
  \move(#1 #2)%
  \bsegment
  \move(1 1)%
  \lcir r:1
  \move(1 0.3)%
  \lvec(1 1.7)%
  \move(0.3 1)%
  \lvec(1.7 1)%
  \esegment
}%

% ---  Attributes  ---

% \attr(x,y)[pos]{name}
% where pos is from rlou

% the start point is the point where the attribut line docks on the
% object.
\def\attr(#1,#2)[#3]#4{%
  \def\pos{#3} \def\r{r} \def\l{l} \def\o{o} \def\u{u}%
  \ifx\pos\r \move(#1 #2) \bsegment \lvec(0.5 0) \textref h:L v:C \htext{$#4$} \esegment%
  \else
    \ifx\pos\l \move(#1 #2) \bsegment \lvec(-0.5 0) \textref h:R v:C \htext{$#4$} \esegment%
    \else
      \ifx\pos\o \move(#1 #2) \bsegment \lvec(0 0.5) \textref h:C v:B \htext{$#4$} \esegment%
      \else
        \ifx\pos\u \move(#1 #2) \bsegment \lvec(0 -0.5) \textref h:C v:T \htext{$#4$} \esegment%
        \else
        \PackageWarning{herm-pic}{%
          Undefind attribute positioning parameter #1 \MessageBreak have to come from r,l,o,u (r as default).
          \MessageBreak Using default [r].
        }%
        \attr(#1,#2)[r]{#4}%
        \fi%
      \fi%
    \fi%
  \fi%
}%

% --- Key marking of attribute values ---

% marks an attribute or an attribute part as a key.

% \key{attribute}

\def\key#1{\underline{#1}}%

% ---  Connection  ---

% Draws an arrow from the start to the endpoint and places the label
% to a 'good' place.

% \connection(x1,y1)(x2,y2){label}
%   \connection(x1,y1)(x2,y2){label}
\def\conn(#1,#2)(#3,#4)#5{%
  \move(#1 #2)
  \arrowheadtype t:V
  \avec(#3 #4)
  \newcount\sx \newcount\sy \newcount\ex \newcount\ey%
  \sx=#1%
  \sy=#2%
  \ex=#3%
  \ey=#4%
  % try to compute placing options
  \newcount\dx \newcount\dy \dx=\ex \dy=\ey%
  \newcount\nsx \newcount\nsy \nsx=\sx \multiply\nsx by -1 \nsy=\sy \multiply\nsy by -1%
  \advance\dx by \nsx \advance\dy by \nsy%
  % place description
  %\showthe\dx \showthe\dy
  \ifnum\dx > 0 %
    \ifnum\dy > 0 %
      \rmove(-0.5 -0.2)
      \textref h:R v:T \htext{$#5$} %
    \else
      \rmove(-0.5 0.2)
      \textref h:R v:B \htext{$#5$} %
    \fi
  \else%
    \ifnum\dy > 0 %
      \rmove(0.5 -0.2)
      \textref h:L v:T \htext{$#5$} %
    \else
      \rmove(0.5 0.2)
      \textref h:L v:B \htext{$#5$} %
    \fi
  \fi%
}%

% ---   END OF MODULE   ---
